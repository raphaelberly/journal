<html>

<head>
    <title>Library - Journal</title>
    {% include 'base/head.html' %}
    <script type=text/javascript src="{{ url_for('static', filename='js/menu.js') }}"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/submenu.js') }}"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/scroll.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/slider.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/recent.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/library.css')}}">
</head>

<body ontouchstart="">

{% with page_title = 'Library' %}
    {% with beta = True %}{% include 'base/menu.html' %}{% endwith %}
{% endwith %}
{% include 'base/alert.html' %}

<div class="recent">

<div class="sort-by-button">
    <button class="styled-button empty" onclick="openSubmenu('sortSubmenu')">Sort by</button>
    <button class="styled-button empty right" onclick="openSubmenu('filterSubmenu')">Filter by</button>
</div>

<center><table>

{% for record, title in payload %}
<tr>
    {% if loop.index0 == 0 %}
        <td class="timeline top"></td>
    {% else %}
        <td class="timeline middle"></td>
    {% endif %}
    <td>
        <b><a href="{{ url_for('movie', tmdb_id=title.id) }}">{{ title.title }} ({{ title.year }})</a>{% if title.imdb_rating %}  <a href="https://imdb.com/title/{{ title.imdb_id }}"><span class="imdb-star"><svg xmlns="http://www.w3.org/2000/svg" class="imdb-star" viewBox="0 0 24 24" fill="currentColor"><path d="M12 20.1l5.82 3.682c1.066.675 2.37-.322 2.09-1.584l-1.543-6.926 5.146-4.667c.94-.85.435-2.465-.799-2.567l-6.773-.602L13.29.89a1.38 1.38 0 0 0-2.581 0l-2.65 6.53-6.774.602C.052 8.126-.453 9.74.486 10.59l5.147 4.666-1.542 6.926c-.28 1.262 1.023 2.26 2.09 1.585L12 20.099z"></path></svg></span>&nbsp;{{ title.imdb_rating }}</a>{% endif %}</b>
        <br/>
        {{ ', '.join(title.genres) }}
        <br/>
        <b>{{ [record.grade|int, record.grade]|max }}/10</b>, added {{ format_date(record.date) | lower }}
    </td>
</tr>
{% endfor %}

</table></center>

{% if metadata.show_more_button %}
<input class="styled-button full" type="button" id="more_button" onclick="javascript:add_scroll_and_load('{{ url_for('library', sort_by=metadata.sort_by, nb_results=payload|length+20) }}')" value="More">
{% endif %}

</div>

<div id="sortSubmenu" class="submenu">
<table>
    <tr><td>
        <a class="{% if metadata.sort_by == 'grade_desc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='grade_desc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            Grade descending
        </a>
    </td></tr>
    <tr><td>
        <a class="{% if metadata.sort_by == 'grade_asc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='grade_asc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            Grade ascending
        </a>
    </td></tr>
    <tr><td>
        <a class="{% if metadata.sort_by == 'imdb_rating_desc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='imdb_rating_desc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            IMDb rating descending
        </a>
    </td></tr>
    <tr><td>
        <a class="{% if metadata.sort_by == 'imdb_rating_asc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='imdb_rating_asc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            IMDb rating ascending
        </a>
    </td></tr>
    <tr><td>
        <a class="{% if metadata.sort_by == 'date_added_desc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='date_added_desc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            Date added descending
        </a>
    </td></tr>
    <tr><td>
        <a class="{% if metadata.sort_by == 'date_added_asc' %}selected{% else %}not-selected{% endif %}" href="{{ url_for('library', sort_by='date_added_asc', submenu='sortSubmenu') }}">
            <span class="sort-radio"></span>
            Date added ascending
        </a>
    </td></tr>
</table>
</div>

<a href="javascript:void(0)" onclick="closeSubmenu('sortSubmenu')"><div class="submenu-back" id="sortSubmenuBack"></div></a>

<div id="filterSubmenu" class="submenu filter-submenu">
<table>
    <tr><td>
        <div class="mentions">Grades between <b><span id="gradeLowerBoundValue"></span>/10</b> and <b><span id="gradeUpperBoundValue"></span>/10</b></div>
        <div class="dual-slider">
            <input id="gradeLowerBound" name="gradeLowerBound" type="range" min="{{ 1 if metadata.grade_as_int else 0 }}" max="10" value="{{ metadata.filter_grades_below or (1 if metadata.grade_as_int else 0) |string }}" step="{{ 1 if metadata.grade_as_int else 0.5 }}" class="slider">
            <input id="gradeUpperBound" name="gradeUpperBound" type="range" min="{{ 1 if metadata.grade_as_int else 0 }}" max="10" value="{{ metadata.filter_grades_above or 10 }}" step="{{ 1 if metadata.grade_as_int else 0.5 }}" class="slider">
        </div>
    </td></tr>
    <tr><td>
        <input class="styled-button full" type="button" onclick="location.href=('{{ url_for('library', sort_by=metadata.sort_by, submenu='filterSubmenu') }}&filter_grades_below=' + document.getElementById('gradeLowerBound').value + '&filter_grades_above=' + document.getElementById('gradeUpperBound').value);" value="Apply filter">
    </td></tr>
</table>
<script type="text/javascript">
// Update gradeLowerBoundValue and gradeUpperBoundValue when sliders move
(function() {
    var lower = document.getElementById('gradeLowerBound');
    var upper = document.getElementById('gradeUpperBound');
    var lowerVal = document.getElementById('gradeLowerBoundValue');
    var upperVal = document.getElementById('gradeUpperBoundValue');
    if (lower && upper && lowerVal && upperVal) {
        function update() {
            // Prevent lower slider from exceeding upper slider
            if (parseFloat(lower.value) > parseFloat(upper.value)) {
                lower.value = upper.value;
            }
            // Prevent upper slider from going below lower slider
            if (parseFloat(upper.value) < parseFloat(lower.value)) {
                upper.value = lower.value;
            }
            lowerVal.textContent = parseFloat(lower.value).toFixed({{ 0 if metadata.grade_as_int else 1 }});
            upperVal.textContent = parseFloat(upper.value).toFixed({{ 0 if metadata.grade_as_int else 1 }});
        }
        lower.addEventListener('input', update);
        upper.addEventListener('input', update);
        update();
    }
})();
</script>
</div>

<a href="javascript:void(0)" onclick="closeSubmenu('filterSubmenu')"><div class="submenu-back" id="filterSubmenuBack"></div></a>

{% if metadata.submenu != 'inactive' %}
<script type = "text/javascript"> instantOpenSubmenu('{{ metadata.submenu }}'); </script>
{% endif %}

{% if metadata.scroll_to %}
<script type = "text/javascript"> window.scrollTo(0, {{ metadata.scroll_to }}); </script>
{% endif %}

</body>
</html>
