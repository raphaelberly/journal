<html>

<head>
    {% include 'base/head.html' %}
    <script type=text/javascript src="{{ url_for('static', filename='js/menu.js') }}"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/referrer.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/search.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/movie.css')}}">
</head>

<body ontouchstart="">

{% with title = 'Search' %}
    {% include 'base/menu.html' %}
{% endwith %}
{% include 'base/alert.html' %}

{% if not query %}
    {% set query = '' %}
{% endif %}

<div class="form-search">

<form method="get" action="{{ url_for('search') }}">
    <input name="query" placeholder="Type a movie title here..." type="text" value="{{ query }}">
    <button type="submit">Go</button>
</form>

</div>


<div class="movies bar">

{% if payload == [] %}
<table>
    <tr><td>
        <img id="img-no-results" src="static/images/fail.png">
    </td></tr>
    <tr><td>
        Wops, no results were found
    </td></tr>
</table>
{% endif %}


{% for item in payload %}
<table>
    {% if item.image %}
    <tr><td>
        {% if item.grade %}
        <a href="javascript:add_referrer_and_load('{{ url_for('movie', movie_id=item.id, query=query, nb_results=payload|length) }}', 'search')"><img src="{{ item.image }}"></a>
        {% else %}
        <a href="javascript:add_referrer_and_load('{{ url_for('movie', movie_id=item.id, query=query, nb_results=payload|length, show_slider=True) }}', 'search')"><img src="{{ item.image }}"></a>
        {% endif %}
    </td></tr>
    {% endif %}
    <tr><td>
        <b>{{ item.title }}{% if item.year %} ({{ item.year }}){% endif %}</b>
        {% if item.genres %}
            <br/>{{ ', '.join(item.genres) }}
        {% endif %}
        {% if item.directors %}
            <br/>By {{ ' and '.join(item.directors) }}
        {% endif %}
        {% if item.cast %}
            <br/>With {{ ', '.join(item.cast) }}
        {% endif %}
        {% if item.duration %}
            <br/>{{ item.duration }}
        {% endif %}
    </td></tr>
    <tr><td>
        {% if not item.grade %}
            {% if not item.in_watchlist %}
            <table class="dual"><tr>
            <td class="left">
                <input class="styled-button full" type="button" onclick="javascript:add_referrer_and_load('{{ url_for('movie', movie_id=item.tmdb_id, query=query, nb_results=payload|length, show_slider=True) }}', 'search');" value="Add">
            </td>
            <td class="right">
                <form onsubmit="this.action=add_referrer('{{ url_for('search', query=query, nb_results=payload|length) }}', 'search');" method="post">
                    <input type="hidden" name="add_to_watchlist" value="{{ item.tmdb_id }}">
                    <input class="styled-button empty" type="submit" value="Watchlist">
                </form>
            </td>
            </tr></table>
            {% else %}
            <input class="styled-button full" type="button" onclick="javascript:add_referrer_and_load('{{ url_for('movie', movie_id=item.tmdb_id, query=query, nb_results=payload|length, show_slider=True) }}', 'search');" value="Add">
            {% endif %}
        {% else %}
        <div class="mentions">
            <img src="/static/images/icon_check.png">
            <b>{{ [item.grade|int, item.grade]|max }}/10</b>, rated {{ format_date(item.date)|lower }}
        </div>
        {% endif %}
    </td></tr>
</table>
{% endfor %}

{% if show_more_button %}
<table>
    <tr><td>
        <a id="show_more_link" href="javascript:add_referrer_and_load('{{ url_for('search', query=query, nb_results=payload|length*2+1) }}', 'search');">More results</a>
    </td></tr>
</table>
{% endif %}

</div>

{% if scroll %}
<script type = "text/javascript"> window.scrollTo(0, {{ scroll }}); </script>
{% endif %}

</body>
</html>
