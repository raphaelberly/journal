<html>

<head>
    {% include 'base/head.html' %}
    <script type=text/javascript src="{{ url_for('static', filename='js/menu.js') }}"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/filter.js') }}"></script>
    <script type=text/javascript src="{{ url_for('static', filename='js/referrer.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/buttons.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/movie.css')}}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/watchlist.css')}}">
</head>

<body ontouchstart="" onload="filterSelection();">

{% with title = 'Watchlist' %}
    {% include 'base/menu.html' %}
{% endwith %}
{% include 'base/alert.html' %}

<div class="movies nobar">

{% if not watchlist %}
<table>
    <tr><td>
    <img id="img-no-results" src="static/images/fail.png">
    </td></tr>
    <tr><td>
    Wops, no movies in watchlist.
    </td></tr>
</table>
{% else %}
<div id="filterContainer" class="providers">
    {% for provider in ['netflix', 'amazonprimevideo'] %}
    <a href="javascript:void(0)" class="btn {{ provider }} {{ 'ON' if provider in providers else 'OFF' }}" onclick="switchFilterState('{{ provider }}')">
        <img src="static/images/providers/{{ provider }}.png">
    </a>
    {% endfor %}
</div>
{% endif %}


{% for item in watchlist.values() %}

<div class="filterDiv {{ ' '.join(item.get('providers')) }} show">
<table>

    <tr><td>
        <a href="javascript:add_referrer_and_load('{{ url_for('movie', movie_id=item['tmdb_id'], show_slider=True) }}', 'watchlist')">
            <img src="{{ item.get('image') }}">
        </a>
    </td></tr>
    <tr><td>
        <b>{{ item.get('title') }}{% if item.get('year') %} ({{ item['year'] }}){% endif %}</b>
        {% if item.get('genres') %}
            <br/>{{ ', '.join(item['genres']) }}
        {% endif %}
        {% if item.get('directors') %}
            <br/>By {{ ' and '.join(item['directors']) }}
        {% endif %}
        {% if item.get('cast') %}
            <br/>With {{ ', '.join(item['cast']) }}
        {% endif %}
        {% if item.get('duration') %}
            <br/>{{ item['duration'] }}
        {% endif %}
    </td></tr>
    {% if item.get('providers')|length > 0 %}
    <tr><td>
        <div class="providers">
        {% for provider in ['netflix', 'amazonprimevideo'] %}
            {% if provider in item.get('providers') %}
            <img src="static/images/providers/{{ provider }}.png">
            {% endif %}
        {% endfor %}
        </div>
    </td></tr>
    {% endif %}
    <tr><td>
        {% if not item.get('grade') %}
        <table class="dual"><tr>
        <td class="left">
            <input class="styled-button full" type="button" onclick="location.href=add_referrer('{{ url_for('movie', movie_id=item['tmdb_id'], show_slider=True) }}', 'watchlist')" value="Add">
        </td>
        <td class="right">
            <form onsubmit="this.action=add_referrer('{{ url_for('watchlist') }}', 'watchlist');" method="post">
                <input type="hidden" name="remove_from_watchlist" value="{{ item['movie'] }}">
                <input class="styled-button empty" type="submit" value="Unlist" onclick="javascript:if (window.confirm('Remove from watchlist?')) {return true;} else {return false;}">
            </form>
        </td>
        </tr></table>
        {% endif %}
    </td></tr>

</table>
</div>

{% endfor %}

</div>

{% if scroll %}
<script type = "text/javascript"> window.scrollTo(0, {{ scroll }}); </script>
{% endif %}

</body>
</html>
